jQuery(document).ready((function(t){"use strict";let e,s=wbs_frequently_product_params.frequently_product_add_to_cart_text;function i(s){e=0;let i=s.find(".vi-wbs-frequently-product-item-check"),r=s.find(".vi-wbs-frequently-sum-price"),n=s.find(".vi-wbs-frequently-sum-price-show-discount"),c=s.find(".vi-wbs-frequently-sum-price-discount-value"),u=parseFloat(r.data("discounted_amount")),l=parseFloat(r.data("discounted_price")),d=r.data("dynamic_price"),f=parseInt(r.data("saved_type")),p=r.data("discount_type"),m=parseFloat(r.data("discount_amount")),_=r.find(".vi-wbs-frequently-sum-price-value"),b=a(i),v=b;s.hasClass("vi-wbs-frequently-products-add-bundle")&&woocommerce_boost_sales_params.crosssell_enable&&e===s.find(".vi-wbs-frequently-product-item-check").length&&(e=0,b=a(i,!0),v=b,d?m>0&&("percent"===p?(m/=100,b=v*(1-m)):b=v-m,b<0&&(b=0),b=parseFloat(o(b,void 0,".","")),u=v-b):l<v&&(u=v-l)),r.data("total_price",b);let w=woocommerce_boost_sales_params.modal_price.replace(o(1),o(b));_.html(w),e===s.find(".vi-wbs-frequently-product-item-check").length&&u>0?(0===f?c.html(woocommerce_boost_sales_params.modal_price.replace(o(1),o(u))):1===f&&c.html(`${o(100*u/v,0)}%`),t(".vi-wbs-frequently-sum-price-show-discount-origin").html(woocommerce_boost_sales_params.modal_price.replace(o(1),o(v))),d&&t(".vi-wbs-frequently-sum-price-show-discount-current").html(w),_.hide(),n.fadeIn(200),s.addClass("vi-wbs-frequently-products-bundle-offer")):(n.hide(),_.fadeIn(200),s.removeClass("vi-wbs-frequently-products-bundle-offer"))}function a(s,i=!1){let a=0;return s.map((function(){let s=t(this),r=s.closest(".vi-wbs-frequently-product-item");if(s.prop("checked")){e++;let t=i?parseInt(r.data("item_quantity")):1;a+=t*parseFloat(r.data("item_price"))}})),a}t(document).on("click",(function(){t(".vi-wbs-show-select").removeClass("vi-wbs-show-select")})),t(document).on("click",".vi-wbs-frequently-product-item-attributes",(function(e){e.stopPropagation();let s=t(this).closest(".vi-wbs-frequently-product-item");t(".vi-wbs-frequently-product-item").not(s).removeClass("vi-wbs-show-select"),s.toggleClass("vi-wbs-show-select")})),t(document).on("click",".vi-wbs-frequently-product-item-attributes-select-modal",(function(t){t.stopPropagation()})),t(".vi-wbs-frequently-product-item-attributes-select-container").map((function(){let e=t(this),s=e.closest(".vi-wbs-frequently-product-item"),a=e.closest(".vi-wbs-frequently-products-container"),r=s.find("img").eq(0);e.wc_variation_form(),e.on("found_variation",(function(o,n){if(n.attributes&&n.is_in_stock&&n.is_purchasable){let o=[],c={};e.find(".vi-wbs-frequently-product-item-attributes-select-item").map((function(){let e=t(this),s=e.find(":selected");c[e.data("attribute_name")]=e.val(),o.push(s.html())}));let u=o.join(", ");s.data("variation_id",n.variation_id),s.data("variation_attributes",c),n.price_html&&(s.data("item_price",parseFloat(n.display_price)),s.find(".vi-wbs-frequently-product-item-price").html(n.price_html),s.find(".vi-wbs-frequently-product-item-price .price").removeClass("price")),s.find(".vi-wbs-frequently-product-item-attributes-value").html(u).attr("title",u);let l=n.image;l.hasOwnProperty("srcset")&&l.srcset&&r.attr("srcset",l.srcset),l.hasOwnProperty("thumb_src")&&l.thumb_src?r.attr("src",l.thumb_src):l.hasOwnProperty("url")&&l.url&&r.attr("src",l.url),i(a)}}))})),t(document).on("change",".vi-wbs-frequently-product-item-attributes-select-item",(function(){t(this).closest(".vi-wbs-frequently-product-item-attributes-select-container").find(".vi-wbs-fp-variation").map((function(){let e=t(this),s=e.find(".vi-wbs-frequently-product-item-attributes-select-item"),i=s.val();e.find(".vi-wbs-fp-value-option").map((function(){let e=t(this),i=s.find(`option[value="${t.escapeSelector(e.data("wbs_fp_option"))}"]`);i.length>0&&!i.prop("disabled")?e.removeClass("vi-wbs-fp-value-disabled"):e.addClass("vi-wbs-fp-value-disabled")})),e.find(".vi-wbs-fp-value-selected").removeClass("vi-wbs-fp-value-selected"),i&&e.find(`.vi-wbs-fp-value-option[data-wbs_fp_option="${t.escapeSelector(i)}"]`).addClass("vi-wbs-fp-value-selected")}))})),t(document).on("click",".vi-wbs-fp-value-option",(function(e){let s=t(this);if(!s.hasClass("vi-wbs-fp-value-disabled")){let t=s.closest(".vi-wbs-fp-value");s.hasClass("vi-wbs-fp-value-selected")?t.find(".vi-wbs-frequently-product-item-attributes-select-item").val("").trigger("change"):t.find(".vi-wbs-frequently-product-item-attributes-select-item").val(s.data("wbs_fp_option")).trigger("change")}})),t(".vi-wbs-frequently-product-item-attributes-select-item").map((function(){t(this).trigger("change")})),t(".single_variation_wrap").on("show_variation",(function(e,s){if(s.attributes&&s.is_in_stock&&s.is_purchasable){let e=t(this).closest(".variations_form ");t(`.vi-wbs-frequently-product-item[data-product_id="${e.data("product_id")}"]`).map((function(){let e=t(this);if(s.variation_id&&e.data("variation_id")!=s.variation_id){e.find("select.vi-wbs-frequently-product-item-attributes-select-item").val("").trigger("change");for(let t in s.attributes)e.find(`select.vi-wbs-frequently-product-item-attributes-select-item[data-attribute_name="${t}"]`).val(s.attributes[t]).trigger("change")}}))}})),t(".vi-wbs-frequently-products-container").map((function(){let e=t(this);e.data("wbs_fp_shortcode").ajax_load&&function(e){t.ajax({url:wbs_frequently_product_params.url,type:"get",dataType:"json",data:{action:"vi_wbs_frequently_product_shortcode_ajax_load",wbs_fp_shortcode:JSON.stringify(e.data("wbs_fp_shortcode")),is_product:wbs_frequently_product_params.is_product,language:wbs_frequently_product_params.language},beforeSend:function(){e.addClass("vi-wbs-frequently-products-ajax-load")},error:function(t){},success:function(s){if("success"===s.status&&s.data){let i=t(s.data);e.replaceWith(i),i.find(".vi-wbs-frequently-product-item-attributes-select-item").map((function(){t(this).trigger("change")}))}else e.remove()},complete:function(){e.removeClass("vi-wbs-frequently-products-ajax-load")}})}(e)})),t(document).on("click",".vi-wbs-frequently-product-item-check",(function(){let a=t(this).closest(".vi-wbs-frequently-products-container");if(0===a.find(".vi-wbs-frequently-product-item-check:checked").length)return!1;let r=a.find(".vi-wbs-frequently-add-to-cart-button");if(i(a),!(e>0))return!1;r.html(s.replace("{number_of_items}",e))}));let r=!1;function o(t,e,s,i){void 0===e&&(e=wbs_frequently_product_params.decimals),void 0===s&&(s=wbs_frequently_product_params.decimal_separator),void 0===i&&(i=wbs_frequently_product_params.thousand_separator);let a=(t=t.toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e})).split(".");return t=a[0].split(",").join(i),2===a.length&&(t=t+s+a[1]),t}t(document).on("click",".vi-wbs-frequently-add-to-cart-button",(function(e){if(e.preventDefault(),!r){r=!0;let e=t(this),s=e.closest(".vi-wbs-frequently-products-container"),i=s.find(".vi-wbs-frequently-add-to-cart-message"),a=s.data("wbs_fp_shortcode"),o=[];s.find(".vi-wbs-frequently-product-item").map((function(){let e=t(this);e.find(".vi-wbs-frequently-product-item-check").prop("checked")&&o.push({product_id:e.data("product_id"),variation_id:e.data("variation_id"),variation_attributes:e.data("variation_attributes")})}));let n={action:"vi_wbs_frequently_product_add_to_cart",nonce:wbs_frequently_product_params.nonce,wbs_fp_shortcode:JSON.stringify(a),data:o,quantity:1,is_cart:wbs_frequently_product_params.is_cart,is_checkout:wbs_frequently_product_params.is_checkout},c=s.find(".vi-wbs-frequently-product-item-attributes-select-item").serializeArray();c.length>0&&c.forEach((function(t){n[t.name]=t.value})),t.ajax({url:wbs_frequently_product_params.url,type:"post",dataType:"json",data:n,beforeSend:function(){e.addClass("loading"),i.html(""),s.addClass("vi-wbs-frequently-products-ajax-load")},error:function(t){i.html('<div class="vi-wbs-frequently-add-to-cart-message-error">An error occurs. Please try again later.</div>')},success:function(e){if("success"===e.status){if(e.after_atc)window.location.href=e.after_atc;else if(wbs_frequently_product_params.is_cart||wbs_frequently_product_params.is_checkout)window.location.href=window.location.href;else{t("body").trigger("wc_fragment_refresh");let e=s.closest(".woocommerce-boost-sales");e.length>0?setTimeout((function(){e.fadeOut(200),jQuery("html").removeClass("wbs-html-overflow")}),3e3):"hide"===a.after_atc&&s.fadeOut(5e3)}1!=woocommerce_boost_sales_params.side_cart_auto_open||jQuery(".xoo-wsc-modal").hasClass("xoo-wsc-active")||jQuery(".xoo-wsc-basket").click(),jQuery("#nm-menu-cart-btn").click()}i.html(`<div class="vi-wbs-frequently-add-to-cart-message-${e.status}">${e.message}</div>`)},complete:function(){e.removeClass("loading"),r=!1,s.removeClass("vi-wbs-frequently-products-ajax-load")}})}}))}));